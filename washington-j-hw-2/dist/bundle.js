(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}var t,r,o,n,a,l,c,u,i,s,h,d,f,m=Object.freeze({gain:.5,numSamples:256}),y=(new Uint8Array(m.numSamples/2),function(e){r.src=e}),p=function(e){e?(l.frequency.setValueAtTime(1e3,t.currentTime),l.gain.setValueAtTime(20,t.currentTime)):l.gain.setValueAtTime(0,t.currentTime)},v=function(e){e?(c.frequency.setValueAtTime(1e3,t.currentTime),c.gain.setValueAtTime(15,t.currentTime)):c.gain.setValueAtTime(0,t.currentTime)},w=function(){return n},g=function(){return t};function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function b(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,S(o.key),o)}}function S(e){var t=function(e,t){if("object"!==M(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!==M(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===M(t)?t:String(t)}var q,T=document.querySelector("#cb-noise"),k=document.querySelector("#cb-hearts"),A=document.querySelector("#cb-bars"),C=document.querySelector("#cb-gradient"),j=document.querySelector("#cb-invert"),F=document.querySelector("#cb-sparkles"),x=document.querySelector("#cb-waveform"),I=!0,O=!1,R=[],E=function(){function e(){var t,r,o,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,o=function(e,t,r){e.moveTo(t,r),e.quadraticCurveTo(t-40,r,t-50,r-50),e.quadraticCurveTo(t-40,r,t-90,r),e.moveTo(t,r),e.quadraticCurveTo(t-40,r,t-50,r+50),e.quadraticCurveTo(t-40,r,t-90,r)},(r=S(r="drawSparkle"))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,this.x=n,this.y=a,this.scale=l,q=a}var t,r;return t=e,r=[{key:"update",value:function(){O&&(this.y--,this.y<=q&&O&&(O=!1,I=!0)),I&&(this.y++,this.y>=750&&I&&(I=!1,O=!0))}},{key:"draw",value:function(e){e.lineWidth=6,e.strokeStyle="rgba(0,0,0,.4)",e.fillStyle="white",e.scale(this.scale,this.scale),e.save(),e.beginPath(),e.translate(this.x-this.x*this.scale,this.y-this.scale*this.y),this.drawSparkle(e,this.x,this.y),e.stroke(),e.fill(),e.restore(),e.setTransform(1,0,0,1,0,0)}}],r&&b(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),z=function(t,r){u=t.getContext("2d"),i=t.width,s=t.height,h=function(t,r,o,n,a,l){var c,u=t.createLinearGradient(0,0,0,a),i=function(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,r){if(t){if("string"==typeof t)return e(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?e(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function(){o=o.call(t)},n:function(){var e=o.next();return c=e.done,e},e:function(e){u=!0,l=e},f:function(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}([{percent:0,color:"#ff66e5"},{percent:.25,color:"#ffe6fb"},{percent:.5,color:"#ffe6fb"},{percent:.75,color:"#ffe6fb"},{percent:1,color:"#ff66e5"}]);try{for(i.s();!(c=i.n()).done;){var s=c.value;u.addColorStop(s.percent,s.color)}}catch(e){i.e(e)}finally{i.f()}return u}(u,0,0,0,s),d=r,f=new Uint8Array(d.fftSize/2)},H=function(e,t,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.save(),e.beginPath(),0==o&&(o=.01),t=t*o/o,r=r*o/o,e.translate(t-t*o,r-o*r),e.scale(o,o),e.moveTo(t,r),e.quadraticCurveTo(t+30,r-40,t+70,r-40),e.arcTo(t+130,r-40,t+130,r,55),e.quadraticCurveTo(t+130,r+70,t,r+170),e.moveTo(t,r),e.quadraticCurveTo(t-30,r-40,t-70,r-40),e.arcTo(t-130,r-40,t-130,r,55),e.quadraticCurveTo(t-130,r+70,t,r+170),e.setTransform(1,0,0,1,0,0),e.restore()},P=!1,D=!1,B={showGradient:!0,showBars:!0,showHearts:!0,showNoise:!0,showInvert:!0,showSparkles:!0,waveData:!0},L=Object.freeze({sound1:"media/Sweet Love - Junko Ohashi.mp3"}),V=function(){var e,u,i;e=L.sound1,u=window.AudioContext||window.webkitAudioContext,t=new u,r=new Audio,y(e),o=t.createMediaElementSource(r),(l=t.createBiquadFilter()).type="highshelf",(c=t.createBiquadFilter()).type="lowshelf",(n=t.createAnalyser()).fftSize=m.numSamples,(a=t.createGain()).gain.value=m.gain,o.connect(l),l.connect(c),c.connect(n),n.connect(a),a.connect(t.destination),console.log("init called"),console.log("Testing utils.getRandomColor() import: ".concat("rgba(".concat((i=function(){return 185*Math.random()+35})(),",").concat(i(),",").concat(i(),",1)")));var s=document.querySelector("canvas");z(s,w()),G(s),U()},G=function(e){var t=document.querySelector("#fs-button"),o=document.querySelector("#play-button");t.onclick=function(t){var r;console.log("init called"),(r=e).requestFullscreen?r.requestFullscreen():r.mozRequestFullscreen?r.mozRequestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen&&r.webkitRequestFullscreen()},o.onclick=function(e){console.log("audioCtx.state before = ".concat(g().state)),"suspended"==g().state&&g().resume(),console.log("audioCtx.state after = ".concat(g().state)),"no"==e.target.dataset.playing?(r.play(),e.target.dataset.playing="yes"):(r.pause(),e.target.dataset.playing="no")};var n=document.querySelector("#slider-volume"),l=document.querySelector("#label-volume");n.oninput=function(e){var t;t=e.target.value,t=Number(t),a.gain.value=t,l.innerHTML=Math.round(e.target.value/2*100)},n.dispatchEvent(new Event("input")),document.querySelector("#track-select").onchange=function(e){y(e.target.value),"yes"==o.dataset.playing&&o.dispatchEvent(new MouseEvent("click"))},document.querySelector("#cb-highshelf").checked=P,document.querySelector("#cb-lowshelf").checked=D,document.querySelector("#cb-highshelf").onchange=function(e){P=e.target.checked,p(P)},document.querySelector("#cb-lowshelf").onchange=function(e){D=e.target.checked,v(D)},p(),v()},U=function e(){requestAnimationFrame(e),function(){var e,t,r,o,n,a,l,c,m,y,p,v,w,g,M,b,S,q,I,O=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),t=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),r=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),o=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),n=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),a=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),l=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),c=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),m=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),y=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),p=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),v=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),w=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),g=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),M=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),b=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),S=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),q=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),I=new E(Math.floor(Math.random()*i*2),Math.floor(Math.random()*s*2)),R.push(e),R.push(t),R.push(r),R.push(o),R.push(n),R.push(a),R.push(l),R.push(c),R.push(m),R.push(y),R.push(p),R.push(v),R.push(w),R.push(g),R.push(M),R.push(b),R.push(S),R.push(q),R.push(I),x.checked?O.waveData&&d.getByteTimeDomainData(f):d.getByteFrequencyData(f),u.save(),u.fillStyle="black",u.globalAlpha=.05,u.fillRect(0,0,i,s),C.checked&&O.showGradient&&(u.save(),u.fillStyle=h,u.globalAlpha=.3,u.fillRect(0,0,i,s),u.restore()),A.checked&&O.showBars){var z=i/64;u.save(),u.fillStyle="rgba(255,102,229,1)";for(var P=0;P<f.length;P++)u.fillRect(0+P*(z+0),456-f[P],z,200);u.restore()}if(k.checked&&O.showHearts){u.save(),u.globalAlpha=.5;for(var D=0;D<f.length;D++){var B=f[D]/255,L=i/2,V=s/2-50;u.lineWidth=6,u.strokeStyle="rgba(255,230,251,.15)",u.fillStyle="#ff66e5",H(u,L,V,B),u.fill(),u.stroke()}u.restore()}F.checked&&O.showSparkles&&(u.save(),R[0].update(),R[0].draw(u),R[1].update(),R[1].draw(u),R[2].update(),R[2].draw(u),R[3].update(),R[3].draw(u),R[4].update(),R[4].draw(u),R[5].update(),R[5].draw(u),R[6].update(),R[6].draw(u),R[7].update(),R[7].draw(u),R[8].update(),R[8].draw(u),R[9].update(),R[9].draw(u),R[10].update(),R[10].draw(u),R[11].update(),R[11].draw(u),R[12].update(),R[12].draw(u),R[13].update(),R[13].draw(u),R[14].update(),R[14].draw(u),R[15].update(),R[15].draw(u),R[16].update(),R[16].draw(u),R[17].update(),R[17].draw(u),R[18].update(),R[18].draw(u),u.restore());for(var G=u.getImageData(0,0,i,s),U=G.data,N=U.length,J=0;J<N;J+=4)if(T.checked&&O.showNoise&&Math.random()<9e-5&&(U[J]=U[J+1]=U[J+2]=0,U[J]=123,U[J+1]=3,U[J+2]=252),j.checked&&O.showInvert){var W=U[J],$=U[J+1],X=U[J+2];U[J]=255-W,U[J+1]=255-$,U[J+2]=255-X}u.putImageData(G,0,0)}(B);var t=new Uint8Array(w().fftSize/2);w().getByteFrequencyData(t)};function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}window.onload=function(){console.log("window.onload called"),J(),V()};var J=function(){var e=new XMLHttpRequest;e.open("GET","data/av-data.json",!0),e.send(),e.onload=function(e){console.log("In onload - HTTP Status Code = ".concat(e.target.status));var t=e.target.responseText;console.log("Success - the file length is ".concat(t.length));var r=JSON.parse(t);document.title=r.title,document.querySelector("h1").innerHTML=r.title;var o,n,a=document.querySelector("#track-select"),l=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return N(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?N(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return l=e.done,e},e:function(e){c=!0,a=e},f:function(){try{l||null==r.return||r.return()}finally{if(c)throw a}}}}(r.songs);try{for(l.s();!(n=l.n()).done;){var c=n.value;o+='<option value="media/'.concat(c,'.mp3">').concat(c,"</option>")}}catch(e){l.e(e)}finally{l.f()}a.innerHTML=o,document.querySelector("#instructions").innerHTML=r.instructions},e.onerror=function(e){return console.log("In onerror - HTTP Status Code = ".concat(e.target.status))}}})();